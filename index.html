<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>High Octane: Pursuit Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Orbitron', sans-serif;
            color: white;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #111;
        }

        canvas {
            box-shadow: 0 0 40px rgba(0,243,255,0.2);
            border: 2px solid #333;
            background: #000;
        }

        /* --- UI OVERLAYS --- */
        .screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            transition: all 0.4s ease;
        }

        .hidden { opacity: 0; pointer-events: none; z-index: -1; }

        h1 {
            font-size: 3rem;
            text-transform: uppercase;
            letter-spacing: 5px;
            color: #00f3ff;
            text-shadow: 0 0 20px #00f3ff;
            margin-bottom: 10px;
        }

        h2 { color: #aaa; font-size: 1.2rem; margin-bottom: 40px; }

        /* CARDS */
        .selection-grid { display: flex; gap: 30px; }
        .card {
            background: linear-gradient(180deg, #1a1a1a, #0a0a0a);
            border: 1px solid #333;
            padding: 30px;
            width: 220px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }
        .card:hover {
            border-color: #00f3ff;
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(0, 243, 255, 0.2);
        }
        .card:hover h3 { color: #00f3ff; }
        .card-preview {
            width: 100%; height: 100px;
            background: #222;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
        }

        /* DASHBOARD UI */
        #dashboard {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            height: 80px;
            background: linear-gradient(0deg, #111, transparent);
            display: none; /* Hidden until game starts */
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 20px;
            gap: 40px;
            pointer-events: none;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .key-cap {
            background: #222;
            border: 1px solid #555;
            color: #fff;
            padding: 5px 15px;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 5px;
            box-shadow: 0 4px 0 #000;
            transition: 0.1s;
        }
        
        .key-active {
            background: #00f3ff;
            color: #000;
            transform: translateY(4px);
            box-shadow: 0 0 0 #000;
        }

        .hud-label { font-size: 10px; color: #888; letter-spacing: 2px; text-transform: uppercase; }

        /* TOP HUD */
        #top-hud {
            position: absolute;
            top: 20px; left: 20px; right: 20px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            display: none;
        }
        
        .stat-bar-container {
            width: 200px;
            background: rgba(0,0,0,0.5);
            border: 1px solid #444;
            height: 10px;
            margin-top: 5px;
            transform: skewX(-20deg);
        }
        .stat-bar { height: 100%; width: 100%; transition: width 0.1s; }
        
        .wanted-stars { color: gold; font-size: 20px; text-shadow: 0 0 10px gold; }

        /* Wasted Screen */
        #wasted-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(100, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 30;
        }
        #wasted-text {
            font-size: 5rem;
            color: #fff;
            background: #000;
            padding: 10px 40px;
            transform: rotate(-5deg);
            border: 4px solid #fff;
            text-shadow: 4px 4px 0 #555;
        }

    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>

    <div id="top-hud">
        <div>
            <div class="hud-label">ARMOR INTEGIRTY</div>
            <div class="stat-bar-container"><div id="hp-bar" class="stat-bar" style="background:#ff3333"></div></div>
        </div>
        <div style="text-align: center;">
            <div class="hud-label">CURRENT SCORE</div>
            <div style="font-size: 24px;" id="score-val">0</div>
        </div>
        <div style="text-align: right;">
            <div class="hud-label">NITROUS OXIDE</div>
            <div class="stat-bar-container"><div id="nitro-bar" class="stat-bar" style="background:#00f3ff"></div></div>
        </div>
    </div>

    <div id="dashboard">
        <div class="control-group">
            <div class="key-cap" id="key-left">‚Üê</div>
            <div class="hud-label">STEER LEFT</div>
        </div>
        <div class="control-group">
            <div class="key-cap" id="key-fire" style="border-color: #ff3333">SPACE</div>
            <div class="hud-label" style="color:#ff3333">WEAPON FIRE</div>
        </div>
         <div class="control-group">
            <div class="key-cap" id="key-nitro" style="border-color: #00f3ff">SHIFT</div>
            <div class="hud-label" style="color:#00f3ff">NITRO BOOST</div>
        </div>
        <div class="control-group">
            <div class="key-cap" id="key-right">‚Üí</div>
            <div class="hud-label">STEER RIGHT</div>
        </div>
    </div>

    <div id="screen-theme" class="screen">
        <h1>Select Sector</h1>
        <h2>Where will you race?</h2>
        <div class="selection-grid">
            <div class="card" onclick="Game.setTheme('metro')">
                <div class="card-preview" style="background: #111; color: cyan;">üèôÔ∏è</div>
                <h3>NEON METRO</h3>
                <p style="color:#666; font-size: 12px;">High Traffic ‚Ä¢ Night Mode</p>
            </div>
            <div class="card" onclick="Game.setTheme('desert')">
                <div class="card-preview" style="background: #420; color: orange;">üèúÔ∏è</div>
                <h3>DUST BOWL</h3>
                <p style="color:#666; font-size: 12px;">Low Vis ‚Ä¢ Offroad</p>
            </div>
            <div class="card" onclick="Game.setTheme('carland')">
                <div class="card-preview" style="background: #131; color: lime;">üå≤</div>
                <h3>GREEN HILLS</h3>
                <p style="color:#666; font-size: 12px;">Balanced ‚Ä¢ Scenic</p>
            </div>
        </div>
    </div>

    <div id="screen-car" class="screen hidden">
        <h1>Select Vehicle</h1>
        <h2>Choose your weapon</h2>
        <div class="selection-grid">
            <div class="card" onclick="Game.setCar('racer')">
                <div class="card-preview" style="background: #222; color: #ff3333;">üèéÔ∏è</div>
                <h3>INTERCEPTOR</h3>
                <p style="color:#666; font-size: 12px;">Speed: A+ | Armor: C</p>
            </div>
            <div class="card" onclick="Game.setCar('muscle')">
                <div class="card-preview" style="background: #222; color: #3333ff;">üöô</div>
                <h3>ENFORCER</h3>
                <p style="color:#666; font-size: 12px;">Speed: B | Armor: B</p>
            </div>
            <div class="card" onclick="Game.setCar('tank')">
                <div class="card-preview" style="background: #222; color: #228822;">üöê</div>
                <h3>JUGGERNAUT</h3>
                <p style="color:#666; font-size: 12px;">Speed: C | Armor: A+</p>
            </div>
        </div>
    </div>

    <div id="wasted-overlay">
        <div id="wasted-text">WASTED</div>
        <h3 style="margin-top:20px">SCORE: <span id="final-score">0</span></h3>
        <button class="key-cap" style="margin-top:20px; cursor:pointer;" onclick="location.reload()">TRY AGAIN</button>
    </div>

</div>

<script>
/**
 * PROFESSIONAL RENDERER ENGINE
 * Uses Procedural drawing (Canvas API) instead of images/emojis
 */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// --- RESIZE LOGIC ---
function resize() {
    canvas.width = 800; // Fixed Internal Resolution
    canvas.height = 600;
}
resize();

// --- CONFIGURATION ---
const THEMES = {
    metro: { 
        road: '#222', grass: '#050505', lane: '#00f3ff', 
        objFn: 'drawBuilding', density: 0.05,
        sky: '#000'
    },
    desert: { 
        road: '#654', grass: '#dcb', lane: '#fff', 
        objFn: 'drawCactus', density: 0.03,
        sky: '#a50'
    },
    carland: { 
        road: '#555', grass: '#282', lane: '#fff', 
        objFn: 'drawTree', density: 0.08,
        sky: '#4af'
    }
};

const CARS = {
    racer: { color: '#ff3333', speed: 12, hp: 60, w: 40, h: 70 },
    muscle: { color: '#3333ff', speed: 9, hp: 100, w: 44, h: 74 },
    tank: { color: '#228822', speed: 7, hp: 150, w: 50, h: 80 }
};

// --- INPUT SYSTEM ---
const Input = { left: false, right: false, up: false, fire: false };

document.addEventListener('keydown', e => {
    if(e.key === 'ArrowLeft') { Input.left = true; highlight('key-left', true); }
    if(e.key === 'ArrowRight') { Input.right = true; highlight('key-right', true); }
    if(e.key === 'Shift') { Input.up = true; highlight('key-nitro', true); }
    if(e.code === 'Space') { Input.fire = true; highlight('key-fire', true); }
});

document.addEventListener('keyup', e => {
    if(e.key === 'ArrowLeft') { Input.left = false; highlight('key-left', false); }
    if(e.key === 'ArrowRight') { Input.right = false; highlight('key-right', false); }
    if(e.key === 'Shift') { Input.up = false; highlight('key-nitro', false); }
    if(e.code === 'Space') { Input.fire = false; highlight('key-fire', false); }
});

function highlight(id, active) {
    const el = document.getElementById(id);
    if(active) el.classList.add('key-active');
    else el.classList.remove('key-active');
}

// --- ARTIST (PROCEDURAL DRAWING) ---
const Artist = {
    drawCar(ctx, x, y, type, color, angle = 0) {
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(angle);
        
        const w = 40, h = 70; // Standard sizes
        
        // Shadow
        ctx.fillStyle = 'rgba(0,0,0,0.5)';
        ctx.fillRect(-w/2 + 5, -h/2 + 5, w, h);

        // Tires
        ctx.fillStyle = '#111';
        ctx.fillRect(-w/2-2, -h/2+5, 4, 12); // FL
        ctx.fillRect(w/2-2, -h/2+5, 4, 12); // FR
        ctx.fillRect(-w/2-2, h/2-17, 4, 12); // RL
        ctx.fillRect(w/2-2, h/2-17, 4, 12); // RR

        // Body Chassis
        ctx.fillStyle = color;
        // Main block
        ctx.beginPath();
        if(type === 'police') {
            ctx.fillStyle = '#111';
            ctx.roundRect(-w/2, -h/2, w, h, 2);
            ctx.fill();
            // White doors
            ctx.fillStyle = '#fff';
            ctx.fillRect(-w/2+1, -10, w-2, 30);
        } else {
            ctx.roundRect(-w/2, -h/2, w, h, 4);
            ctx.fill();
        }

        // Roof/Windshield area
        ctx.fillStyle = '#222'; // Dark glass
        ctx.beginPath();
        ctx.moveTo(-w/2 + 4, -h/2 + 15);
        ctx.lineTo(w/2 - 4, -h/2 + 15);
        ctx.lineTo(w/2 - 5, h/2 - 10);
        ctx.lineTo(-w/2 + 5, h/2 - 10);
        ctx.fill();

        // Roof Top
        ctx.fillStyle = color;
        if(type === 'police') ctx.fillStyle = '#fff';
        ctx.fillRect(-w/2 + 6, -5, w - 12, 25);

        // Lights
        // Headlights
        ctx.fillStyle = '#ffeda0';
        ctx.shadowBlur = 5; ctx.shadowColor = '#ffeda0';
        ctx.fillRect(-w/2 + 3, -h/2, 6, 4);
        ctx.fillRect(w/2 - 9, -h/2, 6, 4);
        ctx.shadowBlur = 0;

        // Taillights
        ctx.fillStyle = '#ff0000';
        ctx.fillRect(-w/2 + 3, h/2 - 2, 6, 2);
        ctx.fillRect(w/2 - 9, h/2 - 2, 6, 2);

        // Spoiler (Sport only)
        if(type === 'sport' || type === 'racer') {
            ctx.fillStyle = '#000'; // Carbon fiber look
            ctx.fillRect(-w/2, h/2 - 8, w, 4);
        }

        // Police Siren
        if(type === 'police') {
            const blink = Date.now() % 200 > 100;
            ctx.fillStyle = blink ? '#f00' : '#00f';
            ctx.fillRect(-10, -2, 8, 4);
            ctx.fillStyle = blink ? '#00f' : '#f00';
            ctx.fillRect(2, -2, 8, 4);
            
            // Siren Glow
            ctx.globalAlpha = 0.3;
            ctx.fillStyle = blink ? '#f00' : '#00f';
            ctx.beginPath(); ctx.arc(0,0, 40, 0, Math.PI*2); ctx.fill();
            ctx.globalAlpha = 1;
        }

        ctx.restore();
    },

    drawTree(ctx, x, y) {
        // Simple vector tree
        ctx.fillStyle = '#420'; // Trunk
        ctx.fillRect(x-4, y, 8, 15);
        ctx.fillStyle = '#161'; // Leaves
        ctx.beginPath();
        ctx.arc(x, y-10, 15, 0, Math.PI*2);
        ctx.fill();
        // Highlight
        ctx.fillStyle = '#282';
        ctx.beginPath(); ctx.arc(x-5, y-15, 8, 0, Math.PI*2); ctx.fill();
    },

    drawCactus(ctx, x, y) {
        ctx.fillStyle = '#262';
        ctx.beginPath();
        ctx.roundRect(x-4, y-20, 8, 30, 4); // Main
        ctx.roundRect(x-12, y-10, 8, 5, 2); // Left arm
        ctx.roundRect(x-12, y-15, 4, 10, 2);
        ctx.fill();
    },

    drawBuilding(ctx, x, y) {
        // Skyscraper top-down/iso fake view
        ctx.fillStyle = '#080808';
        ctx.fillRect(x-20, y-50, 40, 60);
        
        // Windows
        ctx.fillStyle = '#333';
        if(Math.random() > 0.5) ctx.fillStyle = '#550'; // Lights on
        ctx.fillRect(x-15, y-40, 8, 8);
        ctx.fillRect(x+5, y-40, 8, 8);
        ctx.fillRect(x-15, y-20, 8, 8);
    }
};

// --- GAME LOGIC ---
const Game = {
    theme: null,
    carConfig: null,
    active: false,
    frames: 0,
    
    // Physics State
    player: { x: 400, y: 500, speed: 0, maxSpeed: 10, hp: 100, nitro: 100 },
    roadOffset: 0,
    
    entities: [], // Cars
    scenery: [],  // Trees/Buildings
    bullets: [],
    particles: [],

    setTheme(name) {
        this.theme = THEMES[name];
        document.getElementById('screen-theme').classList.add('hidden');
        document.getElementById('screen-car').classList.remove('hidden');
    },

    setCar(name) {
        this.carConfig = CARS[name];
        this.player.maxSpeed = this.carConfig.speed * 1.5;
        this.player.hp = this.carConfig.hp;
        this.player.maxHp = this.carConfig.hp; // Store max for bar calculation
        document.getElementById('screen-car').classList.add('hidden');
        this.start();
    },

    start() {
        this.active = true;
        this.player.speed = 0;
        document.getElementById('top-hud').style.display = 'flex';
        document.getElementById('dashboard').style.display = 'flex';
        this.score = 0;
        this.loop();
    },

    update() {
        this.frames++;
        const p = this.player;

        // 1. Controls & Physics
        if(Input.left) p.x -= 6;
        if(Input.right) p.x += 6;
        
        // Clamp Road
        if(p.x < 210) p.x = 210;
        if(p.x > 590) p.x = 590;

        // Speed Logic
        let targetSpeed = 8;
        if(Input.up && p.nitro > 0) {
            targetSpeed = 16; // Boost
            p.nitro -= 0.5;
            this.createParticles(p.x, p.y + 40, 2, '#00f3ff'); // Nitro flame
        } else {
            if(p.nitro < 100) p.nitro += 0.05; // Regen
        }
        
        // Smooth Acceleration
        p.speed += (targetSpeed - p.speed) * 0.05;

        // 2. Road Movement (Parallax)
        this.roadOffset += p.speed * 2;
        if(this.roadOffset > 100) this.roadOffset = 0;

        // 3. Spawning
        // Traffic
        if(Math.random() < 0.02) {
            const lane = 250 + Math.random() * 300;
            const type = Math.random() < 0.2 ? 'police' : 'civ';
            const enemySpeed = type === 'police' ? 10 : 5 + Math.random() * 2;
            this.entities.push({
                x: lane, y: -100,
                type: type,
                speed: enemySpeed,
                color: type === 'police' ? '#fff' : `hsl(${Math.random()*360}, 60%, 50%)`,
                hp: type === 'police' ? 60 : 20,
                w: 40, h: 70
            });
        }

        // Scenery
        if(Math.random() < this.theme.density) {
            const side = Math.random() > 0.5;
            const x = side ? Math.random() * 180 : 620 + Math.random() * 180;
            this.scenery.push({ x: x, y: -50, fn: this.theme.objFn });
        }

        // Shooting
        if(Input.fire && this.frames % 8 === 0) {
            this.bullets.push({ x: p.x - 15, y: p.y - 20 });
            this.bullets.push({ x: p.x + 15, y: p.y - 20 });
        }

        // 4. Update Arrays
        // Scenery moves purely by player speed (static objects)
        this.scenery.forEach(s => s.y += p.speed * 2);

        // Entities move by RELATIVE speed
        this.entities.forEach(e => {
            // Formula: Enemy moves down if Player > Enemy Speed
            // Enemy moves UP if Enemy Speed > Player (e.g. Police chasing)
            
            let relSpeed = (e.speed - p.speed) * 2; // Multiplier for visual feel
            
            // Police AI: Chase
            if(e.type === 'police') {
                if(e.y < p.y) e.y += (e.speed + 2 - p.speed); // Catch up logic
                else e.y -= 2; // Don't pass player too easily
                
                // Steer towards player
                if(e.y > 0 && Math.abs(e.y - p.y) < 400) {
                    if(e.x < p.x) e.x += 1;
                    else e.x -= 1;
                }
            } else {
                // Civilians just drive forward
                e.y -= relSpeed; // Standard relative motion
            }
        });

        this.bullets.forEach(b => b.y -= 20);
        
        this.particles.forEach(pt => {
            pt.x += pt.vx; pt.y += pt.vy; pt.life -= 0.1;
        });

        // 5. Collision & Cleanup
        this.bullets = this.bullets.filter(b => {
            if(b.y < 0) return false;
            let hit = false;
            this.entities.forEach(e => {
                if(!hit && Math.abs(b.x - e.x) < 20 && Math.abs(b.y - e.y) < 35) {
                    e.hp -= 10;
                    hit = true;
                    this.createParticles(b.x, b.y, 3, '#ffff00'); // Spark
                    if(e.hp <= 0) {
                         this.score += e.type === 'police' ? 500 : 100;
                         this.createParticles(e.x, e.y, 15, '#ff5500'); // Explosion
                         e.dead = true;
                    }
                }
            });
            return !hit;
        });

        this.entities = this.entities.filter(e => {
            if(e.dead) return false;
            
            // Player Crash
            if(Math.abs(p.x - e.x) < (40) && Math.abs(p.y - e.y) < (70)) {
                p.hp -= 2;
                e.hp -= 2;
                this.createParticles((p.x+e.x)/2, (p.y+e.y)/2, 2, '#fff');
                // Bounce
                if(p.x < e.x) p.x -= 2; else p.x += 2;
            }
            
            return e.y < 800 && e.y > -200;
        });
        
        this.scenery = this.scenery.filter(s => s.y < 800);
        this.particles = this.particles.filter(p => p.life > 0);

        // Check Death
        if(p.hp <= 0) this.gameOver();
        
        this.score++;
    },

    draw() {
        // Clear
        ctx.fillStyle = this.theme.grass;
        ctx.fillRect(0,0, canvas.width, canvas.height);

        // Road
        ctx.fillStyle = this.theme.road;
        ctx.fillRect(200, 0, 400, 600);
        
        // Rumble Strips
        const stripH = 40;
        for(let i=-stripH; i<600; i+=stripH) {
            let offsetI = i + this.roadOffset;
            if(offsetI > 600) offsetI -= 600 + stripH;
            
            let color = (Math.floor((i + this.roadOffset)/stripH) % 2 === 0) ? '#fff' : '#f00';
            ctx.fillStyle = color;
            ctx.fillRect(190, offsetI, 10, stripH);
            ctx.fillRect(600, offsetI, 10, stripH);
        }

        // Lanes
        ctx.fillStyle = this.theme.lane;
        for(let i=0; i<600; i+=80) {
            let y = (i + this.roadOffset) % 600;
            ctx.fillRect(395, y, 10, 30);
        }

        // Draw Scenery (Behind cars)
        this.scenery.forEach(s => Artist[s.fn](ctx, s.x, s.y));

        // Draw Entities
        this.entities.forEach(e => {
            Artist.drawCar(ctx, e.x, e.y, e.type, e.color);
        });

        // Draw Bullets
        ctx.fillStyle = '#ff0';
        this.bullets.forEach(b => ctx.fillRect(b.x-2, b.y, 4, 10));

        // Draw Player
        Artist.drawCar(ctx, this.player.x, this.player.y, 'racer', this.carConfig.color);

        // Particles
        this.particles.forEach(p => {
            ctx.globalAlpha = p.life;
            ctx.fillStyle = p.c;
            ctx.fillRect(p.x, p.y, p.s, p.s);
            ctx.globalAlpha = 1;
        });

        // UI Updates
        document.getElementById('score-val').innerText = this.score;
        document.getElementById('hp-bar').style.width = (this.player.hp / this.player.maxHp * 100) + '%';
        document.getElementById('nitro-bar').style.width = this.player.nitro + '%';
    },

    loop() {
        if(!this.active) return;
        this.update();
        this.draw();
        requestAnimationFrame(() => this.loop());
    },

    createParticles(x, y, count, color) {
        for(let i=0; i<count; i++) {
            this.particles.push({
                x: x, y: y,
                vx: (Math.random()-0.5)*10,
                vy: (Math.random()-0.5)*10,
                life: 1.0,
                c: color,
                s: Math.random() * 5 + 2
            });
        }
    },

    gameOver() {
        this.active = false;
        document.getElementById('wasted-overlay').style.display = 'flex';
        document.getElementById('final-score').innerText = this.score;
    }
};

</script>
</body>
</html>
