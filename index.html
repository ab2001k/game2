<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Grand Theft Racer: Wanted</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pricedown&display=swap'); /* GTA Style Font fallback */
        
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Impact', 'Arial Black', sans-serif; /* Aggressive font */
            color: white;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #111;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            background: #222;
            box-shadow: 0 0 50px rgba(0,0,0,1);
            max-height: 100vh;
        }

        /* UI OVERLAYS */
        .screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            transition: opacity 0.5s;
        }

        .hidden { opacity: 0; pointer-events: none; z-index: -1; }

        h1 {
            font-size: 4rem;
            color: #fff;
            text-shadow: 4px 4px 0 #000, -1px -1px 0 #000;
            margin-bottom: 20px;
            letter-spacing: 2px;
            font-style: italic;
        }
        
        h2 { color: #f9b006; font-size: 1.5rem; margin-bottom: 30px; }

        /* SELECTION CARDS */
        .card-container { display: flex; gap: 20px; }

        .card {
            background: linear-gradient(145deg, #222, #111);
            border: 2px solid #444;
            padding: 20px;
            width: 200px;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            border-radius: 10px;
        }
        .card:hover {
            border-color: #f9b006;
            transform: translateY(-10px);
            background: #333;
        }
        .card-icon { font-size: 60px; display: block; margin-bottom: 10px; }
        .card-title { font-size: 20px; color: #fff; font-weight: bold; }
        .card-desc { font-size: 12px; color: #aaa; margin-top: 5px; }

        /* HUD */
        #hud {
            position: absolute;
            top: 20px; right: 20px;
            width: 250px;
            text-align: right;
            pointer-events: none;
            display: none;
        }

        .stat-box { margin-bottom: 10px; }
        .bar-bg { width: 100%; height: 15px; background: rgba(0,0,0,0.8); border: 2px solid #555; transform: skewX(-20deg); }
        .bar-fill { height: 100%; transition: width 0.1s; }
        #hp-bar { background: #2ecc71; width: 100%; }
        #nitro-bar { background: #3498db; width: 100%; }

        #weapon-ui {
            font-size: 24px;
            color: #f9b006;
            text-shadow: 2px 2px 0 #000;
        }

        #wasted {
            position: absolute;
            font-size: 6rem;
            color: #c0392b;
            text-shadow: 4px 4px 0 #000;
            font-weight: 900;
            background: rgba(0,0,0,0.5);
            padding: 20px 100px;
            border-top: 5px solid #c0392b;
            border-bottom: 5px solid #c0392b;
            transform: rotate(-5deg);
            display: none;
        }

        /* TUTORIAL */
        .controls-hint {
            position: absolute;
            bottom: 20px; left: 20px;
            color: rgba(255,255,255,0.6);
            font-size: 14px;
            line-height: 1.5;
            pointer-events: none;
        }
        kbd {
            background: #333;
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid #666;
            color: #fff;
        }

    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <div id="hud">
        <div id="weapon-ui">üî´ UZI <span style="font-size:14px; color:#aaa">‚àû ammo</span></div>
        <div class="stat-box">
            <span style="color:#2ecc71">HEALTH</span>
            <div class="bar-bg"><div id="hp-bar" class="bar-fill"></div></div>
        </div>
        <div class="stat-box">
            <span style="color:#3498db">NITROUS</span>
            <div class="bar-bg"><div id="nitro-bar" class="bar-fill"></div></div>
        </div>
        <div style="font-size: 30px; color: #fff; margin-top:10px;">
            $<span id="score-val">0</span>
        </div>
        <div id="wanted-stars" style="color: #f9b006; font-size: 20px;">‚≠ê‚≠ê‚òÜ‚òÜ‚òÜ</div>
    </div>

    <div class="controls-hint" id="hints">
        <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> STEER &nbsp; <kbd>SPACE</kbd> SHOOT &nbsp; <kbd>SHIFT</kbd> NITRO
    </div>

    <div id="screen-theme" class="screen">
        <h1>GRAND THEFT RACER</h1>
        <h2>SELECT LOCATION</h2>
        <div class="card-container">
            <div class="card" onclick="ui.selectTheme('metro')">
                <div class="card-icon">üåÉ</div>
                <div class="card-title">LIBERTY CITY</div>
                <div class="card-desc">Urban ‚Ä¢ Night ‚Ä¢ Police Heavy</div>
            </div>
            <div class="card" onclick="ui.selectTheme('carland')">
                <div class="card-icon">üå≤</div>
                <div class="card-title">COUNTRYSIDE</div>
                <div class="card-desc">Grass ‚Ä¢ Trees ‚Ä¢ Fast Roads</div>
            </div>
            <div class="card" onclick="ui.selectTheme('desert')">
                <div class="card-icon">üåµ</div>
                <div class="card-title">SANDY SHORES</div>
                <div class="card-desc">Desert ‚Ä¢ Dust ‚Ä¢ Offroad</div>
            </div>
        </div>
    </div>

    <div id="screen-car" class="screen hidden">
        <h1>CHOOSE YOUR RIDE</h1>
        <h2>SELECT VEHICLE</h2>
        <div class="card-container">
            <div class="card" onclick="ui.selectCar('sport')">
                <div class="card-icon">üèéÔ∏è</div>
                <div class="card-title">CHEETAH</div>
                <div class="card-desc">Speed: High<br>Armor: Low</div>
            </div>
            <div class="card" onclick="ui.selectCar('muscle')">
                <div class="card-icon">üöó</div>
                <div class="card-title">STALLION</div>
                <div class="card-desc">Speed: Med<br>Armor: Med</div>
            </div>
            <div class="card" onclick="ui.selectCar('tank')">
                <div class="card-icon">üöô</div>
                <div class="card-title">PATRIOT</div>
                <div class="card-desc">Speed: Low<br>Armor: High</div>
            </div>
        </div>
    </div>

    <div id="wasted">WASTED</div>

    <div id="screen-gameover" class="screen hidden">
        <h1 style="color: #c0392b">BUSTED</h1>
        <p>FINAL CASH: $<span id="final-score">0</span></p>
        <button class="card" style="width:auto" onclick="location.reload()">RESPAWN</button>
    </div>
</div>

<script>
/* --- GAME ENGINE --- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// --- ASSETS & CONFIG ---
const THEMES = {
    metro: { bg: '#1a1a1a', road: '#333', line: '#f9b006', text: '#fff', decor: ['üè¢', 'üè®', 'üè¶'], civs: ['üöï', 'üöô', 'üöê'] },
    carland: { bg: '#2ecc71', road: '#555', line: '#fff', text: '#fff', decor: ['üå≤', 'üå≥', 'üè°'], civs: ['üöó', 'üõª', 'üöú'] },
    desert: { bg: '#e67e22', road: '#7f8c8d', line: '#fff', text: '#000', decor: ['üåµ', 'üèúÔ∏è', 'ü™®'], civs: ['üöç', 'üöî', 'üöê'] }
};

const CARS = {
    sport: { sprite: 'üèéÔ∏è', speed: 9, hp: 50 },
    muscle: { sprite: 'üöó', speed: 7, hp: 80 },
    tank: { sprite: 'üöô', speed: 6, hp: 120 }
};

// --- GAME STATE ---
const Game = {
    state: 'MENU',
    theme: null,
    car: null,
    width: 800,
    height: 600,
    frames: 0,
    speed: 0,
    baseSpeed: 0,
    
    player: { x: 400, y: 500, hp: 100, maxHp: 100, nitro: 100, w: 40, h: 70 },
    
    entities: [],
    bullets: [],
    particles: [],
    decors: [],
    
    score: 0,
    wantedLevel: 1,

    init() {
        this.loop = this.loop.bind(this);
        requestAnimationFrame(this.loop);
    },

    start() {
        this.state = 'PLAYING';
        this.player.hp = this.car.hp;
        this.player.maxHp = this.car.hp;
        this.player.nitro = 100;
        this.score = 0;
        this.baseSpeed = this.car.speed;
        this.speed = 0;
        this.entities = [];
        this.bullets = [];
        
        document.getElementById('hud').style.display = 'block';
    }
};

// --- INPUT ---
const Input = { left: false, right: false, up: false, fire: false };
window.addEventListener('keydown', e => {
    if(e.key === 'ArrowLeft' || e.key === 'a') Input.left = true;
    if(e.key === 'ArrowRight' || e.key === 'd') Input.right = true;
    if(e.key === 'Shift') Input.up = true;
    if(e.key === ' ' || e.key === 'Control') Input.fire = true;
});
window.addEventListener('keyup', e => {
    if(e.key === 'ArrowLeft' || e.key === 'a') Input.left = false;
    if(e.key === 'ArrowRight' || e.key === 'd') Input.right = false;
    if(e.key === 'Shift') Input.up = false;
    if(e.key === ' ' || e.key === 'Control') Input.fire = false;
});

// --- CLASSES ---
class Entity {
    constructor(type) {
        this.type = type; // 'civ', 'police', 'pickup'
        this.x = Math.random() * 380 + 210; // Road bounds
        this.y = -100;
        this.w = 40; 
        this.h = 70;
        this.markedForDelete = false;

        if (type === 'police') {
            this.sprite = 'üöì';
            this.speed = Game.baseSpeed + 2; // Faster than base
            this.hp = 3;
            this.aggro = true;
        } else if (type === 'pickup') {
            this.sprite = '‚ù§Ô∏è';
            this.w = 30; this.h = 30;
            this.speed = 0; // Stationary relative to road
            this.hp = 1;
        } else {
            // Civilian
            const civs = Game.theme.civs;
            this.sprite = civs[Math.floor(Math.random() * civs.length)];
            this.speed = Game.baseSpeed - 2; // Slower
            this.hp = 1;
        }
    }

    update() {
        // Move relative to player speed
        const relSpeed = (this.speed - Game.speed); 
        this.y += (5 - relSpeed); // Items move down screen

        // Police AI
        if (this.type === 'police' && this.y > 0 && this.y < Game.player.y) {
            if (this.x < Game.player.x) this.x += 1;
            else this.x -= 1;
            
            // Siren visual
            if (Game.frames % 10 === 0) this.siren = !this.siren;
        }

        if (this.y > Game.height + 50) this.markedForDelete = true;
    }

    draw() {
        ctx.font = "40px Arial";
        ctx.textAlign = "center";
        
        // Shadow
        ctx.fillStyle = "rgba(0,0,0,0.5)";
        ctx.fillText(this.sprite, this.x + 5, this.y + 35); // offset shadow
        
        // Sprite
        if (this.type === 'police' && this.siren) {
            ctx.shadowBlur = 20;
            ctx.shadowColor = "red";
        }
        ctx.fillText(this.sprite, this.x, this.y + 30);
        ctx.shadowBlur = 0;
    }
}

class Bullet {
    constructor(x, y) {
        this.x = x; this.y = y;
        this.markedForDelete = false;
    }
    update() {
        this.y -= 20; // Fast bullet
        if (this.y < -50) this.markedForDelete = true;
    }
    draw() {
        ctx.fillStyle = "#ffeb3b";
        ctx.fillRect(this.x - 2, this.y, 4, 15);
    }
}

class Decor {
    constructor() {
        this.side = Math.random() > 0.5 ? 'left' : 'right';
        this.x = this.side === 'left' ? Math.random() * 150 : Math.random() * 150 + 600;
        this.y = -50;
        this.sprite = Game.theme.decor[Math.floor(Math.random() * Game.theme.decor.length)];
    }
    update() {
        this.y += Game.speed * 2; // Parallax effect
        if(this.y > Game.height) this.markedForDelete = true;
    }
    draw() {
        ctx.font = "50px Arial";
        ctx.textAlign = "center";
        ctx.fillStyle = "rgba(0,0,0,0.2)"; // Shadow
        ctx.fillText(this.sprite, this.x+5, this.y+5);
        ctx.fillStyle = "white"; // Reset
        ctx.fillText(this.sprite, this.x, this.y);
    }
}

// --- LOGIC LOOP ---
Game.loop = function() {
    if (this.state === 'PLAYING') {
        this.frames++;
        
        // 1. Logic
        // Steering
        if (Input.left) this.player.x -= 7;
        if (Input.right) this.player.x += 7;
        
        // Speed/Nitro
        let targetSpeed = this.baseSpeed;
        if (Input.up && this.player.nitro > 0) {
            targetSpeed += 10;
            this.player.nitro -= 1;
        } else if (this.player.nitro < 100) {
            this.player.nitro += 0.1;
        }
        // Smooth accel
        this.speed += (targetSpeed - this.speed) * 0.1;
        
        // Boundaries
        if (this.player.x < 200) this.player.x = 200; // Left rail
        if (this.player.x > 600) this.player.x = 600; // Right rail

        // Shooting
        if (Input.fire && this.frames % 10 === 0) {
            this.bullets.push(new Bullet(this.player.x, this.player.y - 40));
        }

        // Spawning
        if (Math.random() < 0.02) this.entities.push(new Entity(Math.random() < 0.05 ? 'pickup' : 'civ'));
        if (Math.random() < 0.005) this.entities.push(new Entity('police'));
        if (Math.random() < 0.1) this.decors.push(new Decor());

        // Update Arrays
        this.bullets.forEach(b => b.update());
        this.entities.forEach(e => e.update());
        this.decors.forEach(d => d.update());

        // Collisions
        // Bullets hitting Enemies
        this.bullets.forEach(b => {
            this.entities.forEach(e => {
                if (e.type !== 'pickup' && Math.abs(b.x - e.x) < 30 && Math.abs(b.y - e.y) < 40) {
                    e.hp--;
                    b.markedForDelete = true;
                    if (e.hp <= 0) {
                        e.markedForDelete = true;
                        this.score += e.type === 'police' ? 500 : 100;
                        // Boom effect (simple flash)
                        ctx.fillStyle = "white";
                        ctx.fillRect(0,0,Game.width, Game.height);
                    }
                }
            });
        });

        // Player hitting Entities
        this.entities.forEach(e => {
            if (Math.abs(this.player.x - e.x) < 30 && Math.abs(this.player.y - e.y) < 60) {
                if (e.type === 'pickup') {
                    this.player.hp = Math.min(this.player.maxHp, this.player.hp + 30);
                    e.markedForDelete = true;
                    this.score += 50;
                } else {
                    // Crash
                    this.player.hp -= 10;
                    e.hp--;
                    // Bounce
                    if(this.player.x < e.x) this.player.x -= 20; else this.player.x += 20;
                    
                    if(e.hp <= 0) e.markedForDelete = true;
                }
            }
        });

        // Cleanup
        this.bullets = this.bullets.filter(b => !b.markedForDelete);
        this.entities = this.entities.filter(e => !e.markedForDelete);
        this.decors = this.decors.filter(d => !d.markedForDelete);

        // Game Over
        if (this.player.hp <= 0) {
            this.gameOver();
        }

        this.score++;
    }

    this.draw();
    requestAnimationFrame(this.loop);
};

// --- DRAWING ---
Game.draw = function() {
    // Background
    if (this.state === 'PLAYING') {
        ctx.fillStyle = this.theme.bg;
        ctx.fillRect(0, 0, this.width, this.height);

        // Draw Road
        const roadW = 440;
        const roadX = (this.width - roadW) / 2;
        ctx.fillStyle = this.theme.road;
        ctx.fillRect(roadX, 0, roadW, this.height);
        
        // Road Lines (Moving)
        ctx.setLineDash([40, 40]);
        ctx.lineDashOffset = -this.frames * this.speed;
        ctx.strokeStyle = this.theme.line;
        ctx.lineWidth = 5;
        ctx.beginPath();
        ctx.moveTo(this.width/2, 0);
        ctx.lineTo(this.width/2, this.height);
        ctx.stroke();
        ctx.setLineDash([]); // reset

        // Draw Decor (Below cars)
        this.decors.forEach(d => d.draw());

        // Draw Entities
        this.entities.forEach(e => e.draw());

        // Draw Player
        ctx.font = "50px Arial";
        ctx.textAlign = "center";
        // Player Shadow
        ctx.fillStyle = "rgba(0,0,0,0.5)";
        ctx.fillText(this.car.sprite, this.player.x + 5, this.player.y + 35);
        // Player Sprite
        ctx.fillText(this.car.sprite, this.player.x, this.player.y + 30);
        
        // Muzzle Flash
        if (Input.fire && this.frames % 5 === 0) {
            ctx.fillStyle = "yellow";
            ctx.beginPath();
            ctx.arc(this.player.x, this.player.y - 40, 10, 0, Math.PI*2);
            ctx.fill();
        }

        // Draw Bullets
        this.bullets.forEach(b => b.draw());

        // Update UI
        document.getElementById('score-val').innerText = this.score;
        document.getElementById('hp-bar').style.width = (this.player.hp / this.player.maxHp * 100) + "%";
        document.getElementById('nitro-bar').style.width = this.player.nitro + "%";
        
        // Wanted stars
        let stars = "‚≠ê";
        if (this.score > 1000) stars += "‚≠ê";
        if (this.score > 2000) stars += "‚≠ê";
        if (this.score > 5000) stars += "‚≠ê";
        if (this.score > 10000) stars += "‚≠ê";
        document.getElementById('wanted-stars').innerText = stars;

    } else {
        // Menu Background
        ctx.fillStyle = "#111";
        ctx.fillRect(0, 0, this.width, this.height);
    }
};

Game.gameOver = function() {
    this.state = 'GAMEOVER';
    const wasted = document.getElementById('wasted');
    wasted.style.display = 'block';
    
    // Slow down effect then show menu
    setTimeout(() => {
        wasted.style.display = 'none';
        document.getElementById('screen-gameover').classList.remove('hidden');
        document.getElementById('final-score').innerText = this.score;
        document.getElementById('hud').style.display = 'none';
    }, 2000);
};

// --- UI HANDLERS ---
const ui = {
    selectTheme(name) {
        Game.theme = THEMES[name];
        document.getElementById('screen-theme').classList.add('hidden');
        document.getElementById('screen-car').classList.remove('hidden');
    },
    selectCar(type) {
        Game.car = CARS[type];
        document.getElementById('screen-car').classList.add('hidden');
        Game.start();
    }
};

// Start Loop
Game.init();

</script>
</body>
</html>
